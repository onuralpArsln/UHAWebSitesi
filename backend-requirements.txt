# Backend API Requirements for UHA News Website
# This document specifies the required API endpoints and data structures

## Base Configuration
- Base URL: Configurable via BACKEND_API_URL environment variable
- Default: http://localhost:8000
- Authentication: API key or JWT token (to be implemented)
- Rate Limiting: 1000 requests per hour per IP
- CORS: Enabled for frontend domain

## Required API Endpoints

### 1. Articles Management

#### GET /api/articles
**Purpose**: List articles with pagination and filtering
**Parameters**:
- `page` (int, optional): Page number (default: 1)
- `limit` (int, optional): Items per page (default: 20, max: 100)
- `category` (string, optional): Filter by category
- `search` (string, optional): Search in title and content
- `sortBy` (string, optional): Sort field (publishedAt, title, category)
- `sortOrder` (string, optional): Sort direction (asc, desc)

**Response**:
```json
{
  "articles": [
    {
      "id": "string",
      "title": "string",
      "content": "string (HTML)",
      "summary": "string (plain text, max 160 chars)",
      "author": "string",
      "category": "string",
      "publishedAt": "ISO 8601 datetime",
      "updatedAt": "ISO 8601 datetime",
      "keywords": ["string"],
      "images": [
        {
          "url": "string",
          "lowRes": "string",
          "highRes": "string",
          "width": "number",
          "height": "number",
          "alt": "string",
          "title": "string"
        }
      ],
      "relatedArticles": ["article_id"]
    }
  ],
  "pagination": {
    "page": "number",
    "limit": "number",
    "total": "number",
    "totalPages": "number"
  }
}
```

#### GET /api/articles/:id
**Purpose**: Get single article by ID
**Response**: Single article object (same structure as above)

#### POST /api/articles
**Purpose**: Create new article (CMS integration)
**Request Body**: Article object (same structure as above)
**Response**: Created article with generated ID

#### PUT /api/articles/:id
**Purpose**: Update existing article (CMS integration)
**Request Body**: Article object with updated fields
**Response**: Updated article

#### DELETE /api/articles/:id
**Purpose**: Delete article (CMS integration)
**Response**: Success confirmation

### 2. Related Articles

#### GET /api/related/:id
**Purpose**: Get related articles using AI/sentence transformer
**Parameters**:
- `limit` (int, optional): Number of related articles (default: 4, max: 10)

**Response**:
```json
{
  "articles": [
    {
      "id": "string",
      "title": "string",
      "summary": "string",
      "category": "string",
      "publishedAt": "ISO 8601 datetime",
      "images": [
        {
          "url": "string",
          "lowRes": "string",
          "highRes": "string",
          "width": "number",
          "height": "number",
          "alt": "string"
        }
      ],
      "similarityScore": "number (0-1)"
    }
  ]
}
```

### 3. Categories

#### GET /api/categories
**Purpose**: Get all available categories
**Response**:
```json
{
  "categories": [
    {
      "id": "string",
      "name": "string",
      "description": "string",
      "slug": "string",
      "articleCount": "number"
    }
  ]
}
```

#### POST /api/categories
**Purpose**: Create new category (CMS integration)
**Request Body**: Category object
**Response**: Created category with ID

### 4. RSS Feed

#### GET /api/rss
**Purpose**: Get RSS feed data
**Response**: RSS XML format
**Content-Type**: application/rss+xml

### 5. URL Slug Management

#### GET /api/slug/:id
**Purpose**: Get URL slug for article ID
**Response**:
```json
{
  "id": "string",
  "slug": "string"
}
```

#### POST /api/slug
**Purpose**: Register new slug mapping
**Request Body**:
```json
{
  "id": "string",
  "title": "string"
}
```
**Response**:
```json
{
  "id": "string",
  "title": "string",
  "slug": "string"
}
```

### 6. Comments System

#### GET /api/comments
**Purpose**: Get comments for article
**Parameters**:
- `articleId` (string, required): Article ID
- `offset` (int, optional): Offset for pagination
- `limit` (int, optional): Number of comments (default: 10)

**Response**:
```json
{
  "comments": [
    {
      "id": "string",
      "articleId": "string",
      "name": "string",
      "email": "string (hashed)",
      "content": "string",
      "createdAt": "ISO 8601 datetime",
      "likes": "number",
      "replies": [
        {
          "id": "string",
          "name": "string",
          "content": "string",
          "createdAt": "ISO 8601 datetime"
        }
      ]
    }
  ],
  "hasMore": "boolean"
}
```

#### POST /api/comments
**Purpose**: Submit new comment
**Request Body**:
```json
{
  "articleId": "string",
  "name": "string",
  "email": "string",
  "content": "string"
}
```
**Response**: Created comment object

#### POST /api/comments/:id/like
**Purpose**: Like/unlike comment
**Response**:
```json
{
  "success": "boolean",
  "likes": "number"
}
```

### 7. Breaking News

#### GET /api/breaking-news
**Purpose**: Get breaking news articles
**Parameters**:
- `limit` (int, optional): Number of articles (default: 5)

**Response**: Array of article objects with breaking news flag

### 8. Trending Articles

#### GET /api/trending
**Purpose**: Get trending articles based on views/shares
**Parameters**:
- `limit` (int, optional): Number of articles (default: 10)
- `period` (string, optional): Time period (24h, 7d, 30d)

**Response**: Array of article objects with trending metrics

## Data Requirements

### Article Data Structure
- **ID**: Unique identifier (string)
- **Title**: Article headline (string, max 200 chars)
- **Content**: Full article content (HTML string)
- **Summary**: Article excerpt (plain text, 140-160 chars)
- **Author**: Author name (string)
- **Category**: Article category (string)
- **PublishedAt**: Publication timestamp (ISO 8601)
- **UpdatedAt**: Last update timestamp (ISO 8601)
- **Keywords**: Array of keywords/tags (string array)
- **Images**: Array of image objects with multiple resolutions
- **RelatedArticles**: Array of related article IDs

### Image Data Structure
- **URL**: Original image URL
- **LowRes**: Low-resolution version for SSR (WebP preferred)
- **HighRes**: High-resolution version for client-side loading
- **Width**: Image width in pixels
- **Height**: Image height in pixels
- **Alt**: Alt text for accessibility
- **Title**: Image title/caption

### Category Data Structure
- **ID**: Unique identifier
- **Name**: Category name
- **Description**: Category description
- **Slug**: URL-friendly slug
- **ArticleCount**: Number of articles in category

## Performance Requirements

### Response Times
- Article listing: < 200ms
- Single article: < 100ms
- Related articles: < 300ms
- Search results: < 500ms

### Caching
- Implement Redis or similar for caching
- Cache article data for 5 minutes
- Cache category data for 1 hour
- Cache related articles for 30 minutes
- Implement cache invalidation on updates

### Rate Limiting
- 1000 requests per hour per IP
- 100 requests per minute per IP
- Special limits for CMS endpoints

## Security Requirements

### Authentication
- API key authentication for CMS endpoints
- JWT tokens for user sessions
- Rate limiting to prevent abuse
- Input validation and sanitization

### Data Validation
- Validate all input data
- Sanitize HTML content
- Validate image URLs and dimensions
- Check for malicious content

### CORS Configuration
- Allow frontend domain
- Restrict to necessary HTTP methods
- Include proper headers

## Error Handling

### HTTP Status Codes
- 200: Success
- 201: Created
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 429: Too Many Requests
- 500: Internal Server Error

### Error Response Format
```json
{
  "error": "string",
  "message": "string",
  "code": "string",
  "timestamp": "ISO 8601 datetime"
}
```

## Monitoring & Logging

### Metrics to Track
- API response times
- Error rates
- Cache hit rates
- Request volume
- Popular articles
- Search queries

### Logging Requirements
- Log all API requests
- Log errors with stack traces
- Log performance metrics
- Log security events
- Implement log rotation

## Deployment Requirements

### Environment Variables
- DATABASE_URL: Database connection string
- REDIS_URL: Redis connection string
- JWT_SECRET: JWT signing secret
- API_KEY: API authentication key
- CORS_ORIGIN: Allowed CORS origins

### Health Check Endpoint
- GET /api/health
- Return system status and metrics
- Include database connectivity
- Include cache status

## Future Enhancements

### Planned Features
- Real-time notifications
- User authentication system
- Content scheduling
- Advanced analytics
- Multi-language support
- Content versioning
- Automated content generation
- Social media integration

### API Versioning
- Use URL versioning: /api/v1/
- Maintain backward compatibility
- Deprecate old versions gracefully
- Document version changes

---

## Implementation Notes

1. **Database**: Use PostgreSQL or MongoDB for article storage
2. **Caching**: Implement Redis for performance
3. **Search**: Use Elasticsearch for advanced search capabilities
4. **Images**: Implement CDN for image delivery
5. **Monitoring**: Use tools like Prometheus and Grafana
6. **Logging**: Use structured logging with JSON format
7. **Testing**: Implement comprehensive API testing
8. **Documentation**: Use OpenAPI/Swagger for API documentation

This specification ensures the backend can support all frontend requirements while maintaining high performance and scalability.
